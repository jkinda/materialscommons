<div ng-controller="provenanceProcess">
    <div class="row-fluid">
        <form id="process-tab" class="form-inline span8">
            <fieldset>
                <legend>Process</legend>
                <label>Process Type: </label>
                <select ng-model="process_type"
                        ng-options="p.template_name for p in process_templates|orderBy:'template_name'">
                    <option value="">Select Process Type:</option>
                </select>
                <label>Process: {{ process.template.template_name }}</label>
            </fieldset>
        </form>
    </div>
    <div class="row-fluid">
        <div ng-show="process_type">
            <hr>
            <form class="form-horizontal">
                <cgroup label="Name:">
                    <input ng-model="process.name"  placeholder="Name..." type="text">
                </cgroup>
                <cgroup label="Description:">
                    <textarea class="span8" rows="4" placeholder="Description..."
                              ng-model="process.description"></textarea>
                </cgroup>
                <cgroup label="Version:">
                    <input ng-model="process.version" placeholder="Version..." type="text">
                </cgroup>
            </form>

            <div class="row-fluid well span10">
                <form class="form-horizontal">
                    <label>Selected Machine: <a href="#modalMachine">{{ process.machine.name }}</a></label>

                    <div ng-show="useExisting == 'yes'">
                        <label>Select existing machine: </label>
                        <select ng-model="process.machine"
                                ng-options="mach.name for mach in machines_list">
                        </select>
                    </div>
                    <div ng-show="useExisting == 'no'">
                        <cgroup label="Name:">
                            <input ng-model="process.machine.name" placeholder="Name your machine" type="text">
                        </cgroup>
                        <cgroup label="Contact:">
                            <input ng-model="process.machine.contact_email" placeholder="email.." type="text">
                        </cgroup>
                        <cgroup label="Notes:">
                            <textarea ng-model="process.machine.notes" class="span8" rows="4"
                                      placeholder="Notes..."></textarea>
                        </cgroup>
                        <cgroup ng-repeat="pv in process.machine.model" label="{{ pv.name }}">
                            <input type="text" ng-model="pv.value">
                        </cgroup>
                        <cgroup label="Additional properties:">
                            <select ng-model="bk.p_name">
                                <option ng-repeat="prop in machine_template.model" value="{{ prop.name }}">
                                    {{ prop.name }}
                                </option>
                            </select>
                            <button ng-click="add_property_to_machine()" class="btn">Add</button>
                        </cgroup>
                        <button ng-disabled="!process.machine.name" ng-click="add_machine_to_db()" class="btn-primary">
                            Save
                        </button>
                        <button ng-click="clear_machine()" class="btn-danger">Clear</button>
                    </div>
                </form>
            </div>
            <div class="row-fluid well span10">
                <form class="form-horizontal">
                    <h5>Run</h5>
                    <cgroup label="Start:">
                        <datepicker ng-model='bk.start_run'></datepicker>
                    </cgroup>
                    <cgroup label="Stop:">
                        <datepicker ng-model='bk.stop_run'></datepicker>
                    </cgroup>
                    <cgroup label="Errors:">
                        <textarea class="span8" rows="4" placeholder="Errors..."
                                  ng-model="bk.new_err_msg"></textarea>
                    </cgroup>
                    <cgroup>
                        <button ng-click="add_run()" ng-disabled="!bk.start_run" class="btn btn-info">Add</button>
                    </cgroup>
                </form>
                <div ng-show="process.runs.length > 0">
                    <h5>Previous Runs:</h5>
                    <table class="table">
                        <thead>
                        <th>Start</th>
                        <th>End</th>
                        <th>Error Message</th>
                        </thead>
                        <tbody>
                        <tr ng-repeat="run in process.runs">
                            <td>{{run.started | date:'medium'}}</td>
                            <td>{{run.stopped | date:'medium'}}</td>
                            <td>{{run.error_messages}}
                                <button type="button" class="close" ng-click="remove_run($index);">&times;</button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="row-fluid span10">
                <form class="form-horizontal">
                    <cgroup label="Notes:">
                        <textarea class="span8" rows="4" placeholder="Notes..." ng-model="bk.new_note"/>
                    </cgroup>
                    <cgroup>
                        <button ng-click="add_notes()" ng-disabled="!bk.new_note" class="btn btn-info">Add</button>
                    </cgroup>
                </form>
                <div ng-show="process.notes.length > 0">
                    <h5>Previous Notes:</h5>
                    <table class="table">
                        <thead>
                        <th>Message</th>
                        <th>Who</th>
                        <th>Date Created</th>
                        </thead>
                        <tbody>
                        <tr ng-repeat="note in process.notes">
                            <td>{{note.message}}</td>
                            <td>{{note.who}}</td>
                            <td>{{note.date}}</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="row-fluid span10">
                <form class="form-horizontal">
                    <cgroup label="Citations:">
                        <textarea class="span8" rows="4" placeholder="Citation..." ng-model="bk.new_citation"/>
                    </cgroup>
                    <cgroup>
                        <button ng-click="add_citations()" ng-disabled="!bk.new_citation" class="btn btn-info">Add
                        </button>
                    </cgroup>
                </form>
                <ul>
                    <li ng-repeat="citation in process.citations">
                        {{ citation }}
                    </li>
                </ul>
            </div>
            <div class="row-fluid">
                <div class="span4">
                    <button ng-click="next()" ng-disabled="!process.name" class="btn btn-primary">Next</button>
                    <button ng-click="saveDraft()" class="btn btn-success">Save Draft</button>
                </div>
                <div ng-show="message" class="span4">
                    <div class="alert alert-dismissable alert-info">
                        <button type="button" class="close" data-dismiss="alert">&times;</button>
                        {{message}}
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>
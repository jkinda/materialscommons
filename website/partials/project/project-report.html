
<div class="row-fluid">
    <div class="span12 offset1">
        <div class="span4" ng-controller="ListProjectsController">
            <h4>Project: {{project_obj[0].name}}</h4>
        </div>
        <div class="span6 offset2">
            <!--<select ng-model="view_type"-->
            <!--ui-select2="{placeholder: 'View', allowClear: true, width:'element'}"-->
            <!--ng-multiple="false">-->
            <!--<option></option>-->
            <!--<option value="prov">Provenance View</option>-->
            <!--<option value="thumbnail">Thumbnail View</option>-->
            <!--</select>-->

            <select ng-model="add_to"
                    ui-select2="{placeholder: 'Add', allowClear: true, width:'element'}"
                    ng-multiple="false">
                <option></option>
                <option value="prov">Provenance</option>
                <option value="to_dataset">To Dataset</option>
                <option value="to_project">To Project</option>

            </select>
        </div>
    </div>
</div>

<div ng-show="add_to=='prov'">
<div class="row-fluid">
    <div class="span10 offset1">
        <div ng-show="isCurrentStep('nav_choose_process') && !display">
            <div class="well">
                <button type="button" class="close" ng-click="remove_instructions();">&times;</button>
                <b><u>Instructions - Process</u></b><br>
                <li><b>Process Type:</b> These are defined types of processes. Pre-populated in materials commons.</li>
                <li>Process Type will decide what Inputs and Outputs are required for creating provenance</li>
                <li><b>Machine:</b>Machine can be an experimental machine or either a computation</li>
                <li><b>Runs:</b> Is to keep track of exactly for how many days the process was run.</li>
            </div>
        </div>
        <div ng-show="isCurrentStep('nav_choose_inputs') && !display">
            <div class="well">
                <button type="button" class="close" ng-click="remove_instructions();">&times;</button>
                <b><u>Instructions - Inputs</u></b><br>
                <li><b>Input Files:</b> Select these input files from the project tree. These act as an input to the
                    process
                </li>
                <li><b>Required Input properties:</b> Pick any of the existing or create new. These act as input to
                    the
                    process
                </li>
            </div>
        </div>

        <div ng-show="isCurrentStep('nav_choose_outputs')  && !display">
            <div class="well">
                <button type="button" class="close" ng-click="remove_instructions();">&times;</button>
                <b><u>Instructions - Outputs</u></b><br>
                <li><b>Output Files:</b> Are the files generated by this process. You can pick them from project
                    tree
                </li>
                <li><b>Required Output properties:</b></li>
            </div>
        </div>
    </div>
</div>
<div class="row-fluid">
<div class="span12 offset1">
<div class="span3">
    <div class="well">
        <ul class="nav nav-list">
            <li class="nav-header"><i class="icon-wrench"></i>Steps</li>
            <li ng-class="{'active':isCurrentStep('nav_choose_process')}">
                <a> <i ng-show="process_saved"
                       ng-class="{true: 'icon-autoscroll', false: 'icon-autoscroll-disabled'}[process_saved]"></i>
                    Process</a> <a ng-show="process_saved" ng-controller="ProcessStepController"
                                   ng-click="edit_process()">(edit)</a>
            </li>
            <li ng-class="{'active' : isCurrentStep('nav_choose_inputs')}"><a
                    > <i ng-show="inputs_saved"
                         ng-class="{true: 'icon-autoscroll', false: 'icon-autoscroll-disabled'}[inputs_saved]"></i>
                Inputs </a><a ng-show="inputs_saved" ng-controller="InputStepController"
                              ng-click="edit_input()">(edit)</a>
            </li>
            <li ng-class="{'active' : isCurrentStep('nav_choose_outputs')}"><a
                    > <i ng-show="outputs_saved"
                         ng-class="{true: 'icon-autoscroll', false: 'icon-autoscroll-disabled'}[outputs_saved]"></i>
                Outputs </a> <a ng-show="outputs_saved" ng-controller="OutputStepController" ng-click="edit_output()">(edit)</a>
            </li>
            <li ng-class="{'active' : isCurrentStep('nav_choose_upload')}"><a
                    >Submit </a>
            </li>
        </ul>
    </div>
</div>
<div class="span9">
<div class="block" ng-show="isCurrentStep('nav_choose_process')"
     ng-controller="ProcessStepController" ng-init="init()">
    <form id="process-tab" class="form-inline span8">
        <div class="well">
            <h4>Process Information</h4>
            <label>process type :</label> <select ng-model="process_type">
            <option disabled>Select Process Type:</option>
            <option ng-repeat="p in process_templates" value="{{p}}">
                {{p.template_name}}
            </option>
        </select>


            <div ng-show="process_type">
                <hr/>
                <label>Name:</label> <input ng-model="process.name" placeholder="Name your process" type="text"><br>
                <label>Description:</label>
                <textarea class="input-xlarge" placeholder="Describe your process...."
                          ng-model="process.description"/> <br>

                <label>Machine:</label>
                <select ng-model="machine_selected">
                    <option disabled>pick a machine:</option>
                    <option ng-repeat="m in machines_list" value="{{m}}">{{m.name}}</option>
                    <option disabled>----------</option>

                    <option value="new"> New machine</option>
                </select>

                            <span ng-show="machine_selected=='new'">
                                   <input ng-model="new_machine" placeholder="Machine name..."
                                          type="text">
                                <button ng-click="add_machine_to_db()">Add</button>
                            </span>

                <br>


                <label>Version:</label> <input ng-model="process.version" placeholder="Version V1.1 ...."
                                               type="text"><br> </br>
                <div class="well">
                    <label> Runs:</label> <br>
                    <label>Start: </label><input class="span3" ng-model="start_run" placeholder="start date"
                                                 type="text"><br>
                    <label> stop: </label><input class="span3" ng-model="stop_run" placeholder="end date"
                                                 type="text"><br>
                    <label>Error Msg:</label><textarea class="input-large"
                                                       placeholder="Add error messages ....."
                                                       ng-model="new_err_msg"/><br>
                    <button ng-click="add_error_msg()">Add Run</button>

                    <a style="cursor:pointer" ng-click="customruns=!customruns">previous runs</a>
                    <br>
                                            <span ng-show="customruns">
                                                <br><b>Runs</b>
                                                <li ng-repeat="run in process.runs">
                                                    Started: {{run.started}}<br>
                                                    Ended: {{run.stopped}}<br>
                                                    Error messages: {{run.error_messages}}<br>
                                                </li>

                                            </span>
                </div>

                <br>
                <label>Notes:</label><br><textarea class="input-xlarge" placeholder="enter notes here ....."
                                                   ng-model="new_note"/><br>
                <button ng-click="add_notes()">Add Notes</button>

                <a style="cursor:pointer" ng-click="customnote=!customnote">previous notes</a> <br>
                                        <span ng-show="customnote">
                                            <br><b>Notes</b>
                                             <li ng-repeat="note in process.notes">
                                                 {{note}}
                                             </li>

                                        </span>
                <br>
                <label>Citations:</label><br><textarea class="input-xlarge"
                                                       placeholder="Provide citations here..." ng-model="new_citation"/><br>
                <button ng-click="add_citations()">Add Citations</button>
                <a style="cursor:pointer" ng-click="customcitations=!customcitations">previous citations</a>
                <br>
                                        <span ng-show="customcitations">
                                            <br><b>Citations</b>
                                             <li ng-repeat="cit in process.citations">
                                                 {{cit}}
                                             </li>

                                        </span>
                <br>

                <div>
                    <button class="label label-info" ng-click="save_process()"> Save Process
                    </button>
                </div>


            </div>

        </div>
    </form>
</div>
<div class="block" ng-show="isCurrentStep('nav_choose_inputs')">
    <form id="input-tab" class="form-inline span8">
        <div class="well" ng-controller="ProcessStepController">
            <div ng-repeat="condition in state.attributes.process.required_conditions">
                <div class="well" ng-controller="InputStepController" ng-init="init(condition)">

                    <a style="cursor:pointer" ng-click="showDetails=!showDetails">{{condition_name}}</a>

                    <p style="float: right" ng-show="state.attributes.input_conditions[condition_name]">
                        <button class="btn btn-success">Saved</button>
                    </p>
                    <br>
                                        <span ng-show="showDetails">
                                               <label>Pick one or Create New: </label>
                                            <select ng-model="use_condition">
                                                <option disabled>Pick:</option>
                                                <option disabled> -------------------</option>
                                                <option ng-repeat="ec in existing_conditions" value="{{ec}}"
                                                        ng-click="selected_condition(ec)">
                                                    {{ec.name}}
                                                </option>
                                            </select> <br> <br> <br>

                                            <label>Name:</label><input ng-model="condition.name" type="text"> <br>
                                            <label>Description</label> <input ng-model="condition.description"
                                                                              type="text">
                                            <br>
                                            {{condition.template_description}}<br>   <br>
                                        <div ng-repeat="property in condition.model">
                                            <label>{{property.name}}</label><input ng-model=property.value type="text">
                                        </div>
                                            <button ng-click="save_condition()">Save</button>
                                            <br>
                                            <div class="well">
                                                Add Custom Properties:
                                                <input ng-model="additional_prop" type="text">
                                                <button ng-click="custom_property()">Add Property</button>
                                            </div>
                                        </span>

                </div>
            </div>
            <div class="well" ng-controller="InputStepController">
                <a style="cursor:pointer" ng-click="showDetails=!showDetails">Input files</a><br>
                                <span ng-show="showDetails">
                                        <b>Select the files from project tree shown below</b><br>
                                        <button ng-click="save_selected_input_files()">Add Files</button>
                                </span>

                <div ng-show="added">
                    <li ng-repeat="item in state.attributes.checked_input_filenames">
                        <i class="fa fa-check-square"></i>{{item.name}}
                        <button type="button" class="close" ng-click="removeFile($index);">&times;</button><br>

                    </li>
                    <button class="label label-info" ng-click="next_step()">Next Step</button>
                    <br></br>
                </div>

            </div>

        </div>
    </form>

</div>
<div class="block" ng-show="isCurrentStep('nav_choose_outputs')">
    <form id="output-tab" class="form-inline span8">
        <div class="well" ng-controller="ProcessStepController">
            <h4>Outputs</h4>

            <div ng-repeat="cond in state.attributes.process.required_output_conditions">
                <div class="well" ng-controller="OutputStepController" ng-init="init(cond)">
                    <a style="cursor:pointer" ng-click="showDetails=!showDetails">{{condition_name}}</a>

                    <p style="float: right" ng-show="state.attributes.output_conditions[condition_name]">
                        <button class="btn btn-success">Saved</button>
                    </p>
                    <br>
                                        <span ng-show="showDetails">
                                               <label>Pick one or Create New: </label>
                                            <select ng-model="use_condition">
                                                <option disabled>Pick:</option>
                                                <option disabled> -------------------</option>
                                                <option ng-repeat="ec in existing_conditions" value="{{ec}}"
                                                        ng-click="selected_condition(ec)">
                                                    {{ec.name}}
                                                </option>
                                            </select> <br> <br> <br>

                                            <label>Name:</label><input ng-model="condition.name" type="text"> {{condition.name}}<br>
                                            <label>Description</label> <input ng-model="condition.description"
                                                                              type="text">
                                            <br>
                                            {{condition.template_description}}<br><br>
                                        <div ng-repeat="property in condition.model">
                                            <label>{{property.name}}</label><input ng-model=property.value type="text">
                                        </div>
                                            <button ng-click="save_condition()">Save</button>
                                            <br>
                                            <div class="well">
                                                Add Custom Properties:
                                                <input ng-model="additional_prop" type="text">
                                                <button ng-click="custom_property()">Add Property</button>
                                            </div>
                                        </span>
                </div>
            </div>
            <div class="well" ng-controller="OutputStepController">
                <a style="cursor:pointer" ng-click="showDetails=!showDetails">Output files</a><br>
                                <span ng-show="showDetails">
                                        <b>Select the files from project tree shown below</b><br>
                                        <button ng-click="save_selected_output_files()">Add Files</button>
                                </span>

                <div ng-show="added">
                    <li ng-repeat="item in item_names">
                        <i class="fa fa-check-square"></i>{{item.name}}
                        <button type="button" class="close" ng-click="removeFile($index);">&times;</button><br>

                    </li>
                    <button class="label label-info" ng-click="next_step()">Next Step</button>
                </div>
            </div>
        </div>

    </form>
</div>
<div class="block" ng-show="isCurrentStep('nav_choose_upload')">
    <form id="submit-tab" class="form-inline span8">
        <div ng-hide="done||notdone" class="well" ng-controller="UploadStepController">
            <h4>Verify and Submit</h4>
            <b>Process:</b>

            <div class="well">
                Name:<span>{{state.attributes.process.name}}</span> <br>
                Description:<span>{{state.attributes.process.description}}</span> <br>
                Machine:<span>{{state.attributes.process.machine}}</span> <br>
                Version:<span>{{state.attributes.process.version}}</span> <br>

                Notes:
                    <span ng-repeat="n in state.attributes.process.notes">
                     {{n}}
                    </span> <br>
                Runs:
                <span ng-repeat="r in state.attributes.process.runs">
                    {{r.started}}  -
                    {{r.stopped}}
                    {{r.error_messages}}
                </span> <br>
            </div>

            <b>Inputs:</b>

            <div class="well">
                Input Properties:<br>
                    <span ng-repeat="ip in state.attributes.input_conditions">
                        <a href="#modalCondition" data-toggle="modal"
                           ng-click="get_mode_condition(ip)">{{ip.name}}</a><br>
                    </span><br>
                Input Files:<br>
                    <span ng-repeat="file in state.attributes.checked_input_filenames">
                        <a href="#modalFile" data-toggle="modal" ng-click="get_file(file)">{{file.name}}</a><br>
                    </span><br>
            </div>

            <b>Outputs:</b>

            <div class="well">
                Output Properties:<br>
                    <span ng-repeat="ip in state.attributes.output_conditions">
                        <a href="#modalCondition" data-toggle="modal"
                           ng-click="get_mode_condition(ip)">{{ip.name}}</a><br>
                    </span><br>
                Output Files:<br>
                    <span ng-repeat="file in state.attributes.checked_output_filenames">

                        <a href="#modalFile" data-toggle="modal" ng-click="get_file(file)">{{file.name}}</a> <br>
                    </span><br>
                <!-- Modal -->
                <div id="modalFile" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="modalFileLabel"
                     aria-hidden="true">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h3 id="modalFileLabel">File: {{jet.name}}</h3>
                    </div>
                    <div class="modal-body">
                        <div>
                            <label>Name:</label><span>{{datafile.name}}</span>
                            <label>Type:</label><span>{{datafile.item_type}}</span>
                            <label>Owner:</label><span>{{datafile.owner}}</span>
                            <label>Description:</label><span>{{datafile.description}}</span>
                            <label>notes:</label><span>{{datafile.notes}}</span><br>
                            <label>Tags:</label><span>{{datafile.tags}}</span><br>
                            <label>Access:</label><span>{{datafile.access}}</span><br>
                            <label>Media Type:</label><span>{{datafile.mediatype}}</span><br>
                                <div ng-switch on="fileType">
                                    <div ng-switch-when="image">
                                        <img ng-src="{{ fileSrc }}">
                                        <a ng-href="{{ originalFileSrc }}" download="{{ fileName }}" style="margin-left: 15px">Download</a>
                                    </div>
                                    <a ng-switch-when="other" ng-href="{{ fileSrc }}">{{ doc.name }}</a>
                                </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
                    </div>
                </div>

                <!-- Modal -->
                <div id="modalCondition" class="modal hide fade" tabindex="-1" role="dialog"
                     aria-labelledby="modalConditionLabel" aria-hidden="true">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h3 id="modalConditionLabel">{{jet.name}}</h3>
                    </div>
                    <div class="modal-body">
                        <div>
                            <label>Name:</label><span>{{jet.name}}</span>
                            <label>Type:</label><span>{{jet.template_type}}</span>
                            <label>Description:</label><span>{{jet.description}}</span>
                            <label>Model:</label>

                            <div ng-repeat="kv in model">
                                <label>{{kv.name}}</label> - <span>{{kv.value}}</span>
                            </div>

                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
                    </div>
                </div>


            </div>
        </div>
        <div ng-show="done" class="well">
            <h4>Provenance uploaded successfully</h4>
            <a href="#/mytools/projects/{{proj.id}}" ng-click="selected_project(project_obj[0].id)">view uploaded provenance</a>
        </div>
        <div ng-show="notdone" class="well">
            <h4>Provenance failed</h4>

            <div class="well">
                <b>Because of following reasons:</b><br>
                <a> 1. Project was not selected</a><br>
                <a> 2. Bad input or output files</a> <br>

            </div>
            <button class="btn btn-small btn-info" type="button" ng-click="try_again()">Try Again</button>
        </div>
        <div ng-hide="done||notdone">
            <button class="btn btn-large btn-primary" type="button" ng-click="upload_state()">Submit</button>
            &nbsp;&nbsp;&nbsp
            <button class="btn btn-large btn-danger" type="button" ng-click="cancel_provenance()">Cancel</button>

        </div>
    </form>

</div>
</div>
</div>


</div>
</div>

<div ng-hide="add_to=='prov'" class="row-fluid">
    <div class="span11 offset1">
        <h4>Process Tree</h4>
        <table treetable treedata="tree_process">
            <thead>
            <tr ng-show="selected_proj">
                <th></th>
                <th>Name</th>
                <th>Description</th>
            </tr>
            </thead>
            <tbody>

            <tr ng-repeat="t in tree_process" data-tt-id={{t.c_id}} data-tt-parent-id={{t.parent_id}}>

                <td ng-controller="ProcessReportController">
                    <a href="#/mytools/process/report/{{t.id}}">
                        {{t.name}}</a>
                </td>
                <td>{{t.description}}</td>

            </tr>
            </tbody>
        </table>

    </div>
</div>


<div class="row-fluid">
    <div class="span11 offset1">
        <h4>Project Tree</h4>
        <table treetable treedata="tree_data">
            <thead>
            <tr ng-show="selected_proj">
                <th></th>
                <th>Project</th>
                <th>Type</th>
                <th>Size(kb)</th>
                <th>Owner</th>
                <th>Date</th>
            </tr>
            </thead>
            <tbody>

            <tr  ng-repeat="t in tree_data" data-tt-id={{t.c_id}} data-tt-parent-id={{t.parent_id}}>
               <td>
                   <span type="checkbox" style="margin-bottom: 5px;" ng-click="check(t)" class="treecheckBox">
                        <img src="checkmark.png" ng-show="isChecked(t)" class="checkBox-icon" >
                    </span>
               </td>

                <td><a href="#/mytools/data/edit/{{t.id}}">{{t.name}}</td>
                <td>{{t.type}}</td>
                <td>{{t.size}}</td>
                <td>{{t.owner}}</td>
                <td>{{t.birthtime | toDateString}}</td>
            </tr>
            </tbody>
        </table>

    </div>
</div>

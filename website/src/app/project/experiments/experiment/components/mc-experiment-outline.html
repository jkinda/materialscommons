<script type="text/ng-template" id="experiment-simple-step.html">
    <div ui-tree-handle class="experiment-step tree-node-content simple-experiment-view" flex="95"
         layout="column">
        <div flex layout="column" class="mc-experiment-outline-step"
             ng-class="{'step-selected': $ctrl.currentStep === step}"
             on-enter="$ctrl.addBlankStep(this)">
            <div flex layout-fill layout="row" style="padding-top: 9px; padding-left: 10px;">
                <i class="fa fa-fw fa-reorder"></i>
                <div flex data-nodrag layout="row" layout-fill layout-align="start center"
                     style="outline: none"
                     ng-click="$ctrl.setCurrent(step, this)">
                    <span>
                        <md-checkbox data-nodrag class="mc-done" ng-model="step.flags.done"
                                     style="margin-bottom:14px"></md-checkbox>
                        <a data-nodrag ng-click="this.toggle()">
                            <i class="fa fa-fw"
                               ng-class="{'fa-chevron-right': collapsed || !step.steps.length, 'fa-chevron-down': !collapsed && step.steps.length}"></i>
                        </a>
                        <input ng-if="!step.flags.done"
                               size="40" type="text" data-nodrag
                               ng-model="step.name"
                               ng-model-options="{debounce: 250}"
                               ng-change="$ctrl.onChange(step)"
                               placeholder="Title..."
                               class="mc-input-no-border"
                               id="{{step.id}}">
                        <span ng-if="step.flags.done"
                              class="mark-text-done">
                            {{::step.name | truncate:40:'....'}}
                        </span>
                    </span>
                    <span flex></span>
                    <a class="md-primary" data-nodrag ng-click="step.displayState.open = !step.displayState.open"
                       style="padding-bottom: 14px">
                        <i class="fa fa-fw"
                           ng-class="{'fa-angle-double-right': !step.displayState.open, 'fa-angle-double-down': step.displayState.open}"></i>
                    </a>
                    <div flex="10" layout-fill layout="row" layout-align="start center" style="padding-bottom:14px">
                        <i ng-class="{'mc-review-color': step.flags.review, 'mc-light-grey-color': !step.flags.review}"
                           class="fa fa-fw fa-circle"></i>
                        <i ng-class="{'mc-error-color': step.flags.error, 'mc-light-grey-color': !step.flags.error}"
                           class="fa fa-fw fa-bomb"></i>
                        <i ng-class="{'mc-important-color': step.flags.important, 'mc-light-grey-color': !step.flags.important}"
                           class="fa fa-fw fa-exclamation-circle"></i>
                    </div>
                </div>
                <a class="mc-error-color" data-nodrag ng-click="$ctrl.remove(this)">
                    <i class="fa fa-fw fa-remove"></i>
                </a>
            </div>
        </div>
        <div ng-if="step.displayState.open" data-nodrag flex-offset="5">
            <mc-experiment-details step="step" editor-options="$ctrl.editorOptions" ng-cloak>
            </mc-experiment-details>
        </div>
    </div>
    <ol ui-tree-nodes="" ng-model="step.steps" ng-class="{hidden: collapsed}">
        <li ng-repeat="step in step.steps" ui-tree-node ng-include="'experiment-simple-step.html'">
        </li>
    </ol>
</script>

<div layout="column" layout-margin style="max-height: 70vh;">
    <md-content ui-tree id="tree-root" ng-if="$ctrl.experiment.steps.length">
        <ol ui-tree-nodes ng-model="$ctrl.experiment.steps">
            <li ng-repeat="step in $ctrl.experiment.steps" ui-tree-node
                ng-include="'experiment-simple-step.html'">
            </li>
        </ol>
    </md-content>
</div>
<script type="text/ng-template" id="experiment-detail-step.html">
    <div ui-tree-handle class="experiment-step tree-node-content" layout="column" style="margin-top: 30px">
        <div layout="row" style="margin-bottom:10px">
            <div flex-offset="80" flex="5" style="text-align: center">
                <span class="md-subhead">Done</span>
            </div>
            <div style="text-align: center" flex-offset="5">
                <span class="md-subhead">Flags</span>
            </div>
        </div>
        <div layout="row">
            <div layout="column">
                <i class="fa fa-fw fa-reorder"></i>
                <a data-nodrag ng-click="this.toggle()">
                    <i class="fa fa-fw"
                       ng-class="{'fa-chevron-right': collapsed || !step.steps.length, 'fa-chevron-down': !collapsed && step.steps.length}"></i>
                </a>
            </div>
            <md-card md-whiteframe data-nodrag
                     ng-class="{'step-selected': step.selected, 'current-step': step === $ctrl.currentStep}" flex>
                <md-card-header>
                    <md-card-header-text layout="column" flex>
                        <div layout="row" layout-align="space-between start">
                            <a flex="30" class="md-title" ng-click="$ctrl.toggleSelected(step)">
                                {{::step.title | truncate:40:'...'}}
                            </a>
                            <a flex="10" ng-click="$ctrl.promptForRepeat(step)"><i class="fa fa-fw fa-repeat"></i></a>
                            <a class="md-warn" data-nodrag ng-click="$ctrl.remove(this)" style="color:#ff5824">
                                <i class="fa fa-fw fa-remove"></i>
                            </a>
                        </div>
                        <span class="md-subhead-light">{{::step.description | truncate:60:'...'}}</span>
                        <div layout="row">
                            <div ng-if="step.flag.done" flex="25" class="mc-flag mc-done-bg">done</div>
                            <div ng-if="step.flag.review" flex="25" class="mc-flag mc-review-bg">review</div>
                            <div ng-if="step.flag.error" flex="25" class="mc-flag mc-error-bg">error</div>
                            <div ng-if="step.flag.important" flex="25" class="mc-flag mc-important-bg">important</div>
                        </div>
                    </md-card-header-text>
                </md-card-header>
            </md-card>
            <div layout="row" layout-align="start center" flex="10">
                <md-checkbox data-nodrag class="mc-done" ng-model="step.flag.done">Done</md-checkbox>
            </div>
            <div layout="column" layout-align="end start" flex="10">
                <md-checkbox data-nodrag class="mc-review" ng-model="step.flag.review">Review</md-checkbox>
                <md-checkbox data-nodrag class="mc-error" ng-model="step.flag.error">Error</md-checkbox>
                <md-checkbox data-nodrag class="mc-important" ng-model="step.flag.important">Important</md-checkbox>
            </div>
        </div>
    </div>
    <ol ui-tree-nodes="" ng-model="step.steps" ng-class="{hidden: collapsed}">
        <li ng-repeat="step in step.steps" ui-tree-node ng-include="'experiment-detail-step.html'">
        </li>
    </ol>
</script>

<div layout="column" layout-margin style="max-height: 60vh">
    <md-content ui-tree id="tree-root" ng-if="$ctrl.experiment.steps.length">
        <ol ui-tree-nodes ng-model="$ctrl.experiment.steps">
            <li ng-repeat="step in $ctrl.experiment.steps" ui-tree-node
                ng-include="'experiment-detail-step.html'">
            </li>
        </ol>
    </md-content>
</div>
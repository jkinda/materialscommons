<div layout="column" flex layout-margin style="overflow: hidden">
    <div ng-if="false" layout="row" flex layout-align="start start">
        <div layout="column" flex="100" layout-align="start stretch" md-whiteframe>
            <md-toolbar style="background-color: white" flex>
                <div layout="row" layout-align="start center"
                     style="background-color:#e9e9e9; padding-left:8px; padding-right:8px">
                    <md-input-container md-no-float style="margin-top: 5px; margin-bottom:5px" flex="40">
                        <input type="text" ng-model="$ctrl.query" placeholder="SEARCH...">
                        <md-icon md-font-icon="fa-search" class="fa"
                                 style="display:inline-block; color:grey; bottom: 23px"></md-icon>
                    </md-input-container>
                    <span flex></span>
                    <a ng-click="$ctrl.showTableView = true"
                       ng-style="!$ctrl.showTableView && {'color': 'black'}">
                        <i class="fa fa-fw fa-th-list" style="margin-bottom: 15px"></i>
                    </a>
                    <a ng-click="$ctrl.showTableView = false"
                       ng-style="$ctrl.showTableView && {'color': 'black'}">
                        <i class="fa fa-fw fa-th" style="margin-bottom: 15px"></i>
                    </a>
                </div>
            </md-toolbar>
        </div>
    </div>

    <div layout="row" flex>
        <md-sidenav flex="30" md-is-locked-open="true" style="max-height: 82vh;">
            <span style="text-align: center">Step Details</span>
            <md-content layout="column" ng-if="$ctrl.currentStep">
                <a class="md-subtitle"
                   ng-click="$ctrl.currentStep.details.showTitle = !$ctrl.currentStep.details.showTitle">
                    <i class="fa fa-fw"
                       ng-class="{'fa-chevron-right': !$ctrl.currentStep.details.showTitle, 'fa-chevron-down': $ctrl.currentStep.details.showTitle}"></i>
                    Title
                </a>
                <div ng-if="$ctrl.currentStep.details.showTitle" layout="column">
                    <md-input-container md-no-float>
                        <input type="text" ng-model="$ctrl.currentStep.title" placeholder="Title...">
                    </md-input-container>
                    <md-input-container md-no-float>
                    <textarea type="text" ng-model="$ctrl.currentStep.description"
                              placeholder="Description..."></textarea>
                    </md-input-container>
                </div>
                <div ng-if="!$ctrl.currentStep.details.showTitle" style="margin-bottom:18px"></div>

                <a class="md-subtitle" style="margin-bottom:18px;"
                   ng-click="$ctrl.currentStep.details.showStatus = !$ctrl.currentStep.details.showStatus">
                    <i class="fa fa-fw"
                       ng-class="{'fa-chevron-right': !$ctrl.currentStep.details.showStatus, 'fa-chevron-down': $ctrl.currentStep.details.showStatus}"></i>
                    Status
                </a>
                <div ng-if="$ctrl.currentStep.details.showStatus">
                    <md-checkbox data-nodrag class="mc-done" ng-model="$ctrl.currentStep.flag.done">Done</md-checkbox>
                    <md-checkbox data-nodrag class="mc-review" ng-model="$ctrl.currentStep.flag.review">Review
                    </md-checkbox>
                    <md-checkbox data-nodrag class="mc-error" ng-model="$ctrl.currentStep.flag.error">Error
                    </md-checkbox>
                    <md-checkbox data-nodrag class="mc-important" ng-model="$ctrl.currentStep.flag.important">
                        Important
                    </md-checkbox>
                </div>

                <a class="md-subtitle" style="margin-bottom:18px; margin-top: 18px"
                   ng-click="$ctrl.currentStep.details.showNotes = !$ctrl.currentStep.details.showNotes">
                    <i class="fa fa-fw"
                       ng-class="{'fa-chevron-right': !$ctrl.currentStep.details.showNotes, 'fa-chevron-down': $ctrl.currentStep.details.showNotes}"></i>
                    Notes
                </a>
                <textarea ng-if="$ctrl.currentStep.details.showNotes" ckeditor="editorOptions"
                          ng-model="$ctrl.currentStep.notes">
                </textarea>

                <a class="md-subtitle" style="margin-bottom:18px; margin-top: 18px"
                   ng-click="$ctrl.currentStep.details.showSamples = !$ctrl.currentStep.details.showSamples">
                    <i class="fa fa-fw"
                       ng-class="{'fa-chevron-right': !$ctrl.currentStep.details.showSamples, 'fa-chevron-down': $ctrl.currentStep.details.showSamples}"></i>
                    Samples
                </a>
                <div ng-if="$ctrl.currentStep.details.showSamples">
                    <md-tabs md-selected="$ctrl.details.currentSamplesTab" md-border-bottom>
                        <md-tab>
                            <md-tab-label>
                                Input Samples
                            </md-tab-label>
                            <md-tab-body>
                                Show input samples here
                            </md-tab-body>
                        </md-tab>
                        <md-tab>
                            <md-tab-label>
                                Output Samples
                            </md-tab-label>
                            <md-tab-body>
                                Show output samples here
                            </md-tab-body>
                        </md-tab>
                    </md-tabs>
                </div>

                <a class="md-subtitle" style="margin-bottom:18px; margin-top: 18px"
                   ng-click="$ctrl.currentStep.details.showFiles = !$ctrl.currentStep.details.showFiles">
                    <i class="fa fa-fw"
                       ng-class="{'fa-chevron-right': !$ctrl.currentStep.details.showFiles, 'fa-chevron-down': $ctrl.currentStep.details.showFiles}"></i>
                    Files
                </a>
                <div ng-if="$ctrl.currentStep.details.showFiles">
                    <md-tabs md-selected="$ctrl.details.currentFilesTab" md-stretch-tabs md-border-bottom>
                        <md-tab>
                            <md-tab-label>
                                Input Files
                            </md-tab-label>
                            <md-tab-body>
                                Show input files here
                            </md-tab-body>
                        </md-tab>
                        <md-tab>
                            <md-tab-label>
                                Output Files
                            </md-tab-label>
                            <md-tab-body>
                                Show output files here
                            </md-tab-body>
                        </md-tab>
                    </md-tabs>
                </div>
            </md-content>
        </md-sidenav>
        <div layout="column" flex="80" layout-margin>
            <div layout="row" layout-align="space-between center">
                <div>
                    <md-button class="md-primary" ng-class="{'md-hue-2': $ctrl.addHeadings}"
                               ng-click="$ctrl.addHeadings = true; $ctrl.addProcesses = false">
                        Add Headings
                    </md-button>
                    <md-button class="md-primary" ng-class="{'md-hue-2': $ctrl.addProcesses}"
                               ng-click="$ctrl.addProcesses = true; $ctrl.addHeadings = false">
                        Add Processes
                    </md-button>
                </div>
                <div>
                    <md-button class="md-primary" ng-click="$ctrl.showSimple = !$ctrl.showSimple">
                        Toggle View
                    </md-button>
                </div>
                <div>
                    <md-button class="md-primary" ng-click="$ctrl.expandAll()">Expand all</md-button>
                    <md-button class="md-warn" ng-click="$ctrl.collapseAll()">Collapse all</md-button>
                </div>
            </div>

            <div ng-if="$ctrl.addProcesses" style="margin-top: 9px; margin-bottom: 18px">
                <md-autocomplete md-selected-item="$ctrl.selectedProcess"
                                 md-item-text="process.name"
                                 md-items="process in $ctrl.getMatches(searchText)"
                                 md-selected-item-change="$ctrl.addProcess()"
                                 md-select-on-match="true"
                                 md-delay="200"
                                 md-no-cache="true"
                                 placeholder="Choose process..."
                                 on-enter="$ctrl.addProcess()"
                                 md-search-text="$ctrl.searchText">
                    <md-item-template>
                        <span md-highlight-text="$ctrl.searchText">{{process.name}}</span>
                    </md-item-template>
                    <md-not-found>
                        Unknown process {{$ctrl.searchText}}
                        <a ng-click="$ctrl.newProcessEntry($ctrl.searchText)">Click to create new process type</a>
                    </md-not-found>
                </md-autocomplete>
            </div>
            <md-input-container ng-if="$ctrl.addHeadings" md-no-float style="margin-bottom:0">
                <input type="text" on-enter="$ctrl.addHeading()"
                       ng-model="$ctrl.heading" placeholder="Add heading...">
            </md-input-container>

            <div layout="row" layout-align="space-between start" style="margin-bottom: 20px;">
                <div class="md-subhead-light">
                    Adding at <span
                        style="color:#1565c0">{{$ctrl.selectedStep ? $ctrl.selectedStep.title : 'Top level'}}</span>
                </div>

                <div class="md-subhead-light">
                    Editing <span
                        style="color: #ff5824">{{$ctrl.currentStep ? $ctrl.currentStep.title : 'None'}}</span>
                </div>
            </div>
            <div flex="80">
                <mc-experiment-outline-simple-view ng-if="!$ctrl.showSimple"
                                                   current-step="$ctrl.currentStep"
                                                   selected-step="$ctrl.selectedStep"
                                                   experiment="$ctrl.experiment">
                </mc-experiment-outline-simple-view>
                <mc-experiment-outline-detail-view ng-if="$ctrl.showSimple" experiment="$ctrl.experiment">
                </mc-experiment-outline-detail-view>
            </div>
        </div>
    </div>
</div>